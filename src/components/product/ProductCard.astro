---
import { iconItems } from "@/lib/utils/iconItems"

interface Props {
	name: string
	href: string
	image: string
	alt: string
	description: string
	stars?: number
	address?: string
	difficultyLevel?: string
	duration?: string
	priceUSD?: number
	priceCLP?: number
	services: { name: string; free?: boolean; available: boolean }[]
}

const props = Astro.props as Props

// FunciÃ³n para generar las estrellas
const renderStars = (count: number) => {
	let starIcons = ""
	for (let i = 0; i < count; i++) {
		starIcons += "â˜…" // Unicode star character
	}
	return starIcons
}

// Mapeo simple de iconos (puedes reemplazar con SVGs de Heroicons o similar)
const serviceIcons: { [key: string]: string } = {
	"Estacionamiento": "ðŸ…¿ï¸",
	"Gimnasio": "ðŸ‹ï¸",
	"Restaurante": "ðŸ½ï¸",
	"Bar": "ðŸ·",
	"Piscina": "ðŸŠ",
	"Aire Acondicionado": "â„ï¸",
	"SPA": "ðŸ§–â€â™€ï¸",
	"Internet - HabitaciÃ³n": "ðŸ’»",
	"Internet - Wi-Fi": "ðŸ“¶",
	// AÃ±ade mÃ¡s segÃºn tus necesidades
}
const services = Array.isArray(props.services) ? props.services : JSON.parse(props.services || "[]")
---

<article
	class="flex h-full flex-col overflow-hidden rounded-xl bg-white shadow-md transition-shadow duration-300 hover:shadow-lg"
>
	<figure class="relative h-48 w-full overflow-hidden">
		<img
			src={props.image}
			alt={props.alt}
			width="290"
			height="183"
			class="h-full w-full object-cover object-center"
			loading="lazy"
		/>
	</figure>
	<div class="flex flex-grow flex-col p-5">
		<h3 class="mb-2 text-xl font-semibold text-gray-900">
			<a href={props.href} class="transition-colors hover:text-blue-600">
				{props.name}
				{
					props.stars && props.stars > 0 && (
						<span
							class="ml-2 align-middle text-lg text-yellow-500"
							aria-label={`CalificaciÃ³n: ${props.stars} estrellas`}
						>
							{renderStars(props.stars)}
						</span>
					)
				}
			</a>
		</h3>
		<p class="mb-2 text-sm text-gray-600">{props.address}</p>
		<p class="mb-4 flex-grow text-sm text-gray-700">{props.description}</p>

		{
			(props.priceUSD || props.priceCLP) && (
				<ul class="mb-4 flex items-center justify-end font-semibold text-gray-800">
					{props.priceCLP && (
						<li class="mr-4 flex items-center">
							<span class="mr-1 text-xs">Desde</span>
							<span class="text-base text-blue-700">
								<span class="text-sm">CLP $</span>
								{props.priceCLP.toLocaleString("es-CL")}
							</span>
						</li>
					)}
					{props.priceUSD && (
						<li class="flex items-center">
							<span class="mr-1 text-xs">Desde</span>
							<span class="text-base text-blue-700">
								<span class="text-sm">US$</span>
								{props.priceUSD}
							</span>
						</li>
					)}
				</ul>
			)
		}

		{
			props.services?.length > 0 && (
				<ul class="mb-4 flex flex-wrap gap-2 text-xs text-gray-700">
					{props.services
						.filter((s) => s.available)
						.map((service) => (
							<li class="flex items-center rounded-md bg-gray-50 px-2 py-1">
								<span class="mr-1" aria-hidden="true">
									{serviceIcons[service.name] || "â€¢"}
								</span>
								<span>{service.name}</span>
								{service.free && <span class="ml-1 font-medium text-green-600">Gratis</span>}
							</li>
						))}
					{services.map((s: { id: string; name: string; icon: string }) => {
						const iconData = iconItems.find((item) => item.id === s.icon)
						const Icon = iconData?.icon
						return (
							<li class="flex items-center space-x-2 text-sm text-gray-700">
								{Icon && <Icon class="h-3 w-3 text-blue-500" />}
								<small>{s.name}</small>
							</li>
						)
					})}
				</ul>
			)
		}

		<div class="mt-auto flex justify-end">
			<a
				href={props.href}
				class="inline-flex items-center rounded-md border border-transparent bg-blue-600 px-6 py-2 text-sm font-medium text-white shadow-sm transition-colors duration-200 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
			>
				Ver Hotel
			</a>
		</div>
	</div>
</article>
